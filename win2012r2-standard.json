{ "variables":{
  "name":"{{env `VM_NAME`}}",
  "password":"{{env `VM_PASSWORD`}}"
},
  "builders": [{
    "type": "vmware-iso",
    "vm_name": "{{user `name`}}",
    "version" : 8,
    "output_directory":"./build/{{user `name`}}",
    "iso_url": "/srv/internal/other/software/microsoft_windows_server/en_windows_server_2012_r2_with_update_x64_dvd_6052708.iso",
    "iso_checksum_type": "md5",
    "iso_checksum": "78bff6565f178ed08ab534397fe44845",
    "headless": true,
    "boot_wait": "2m",
    "communicator": "winrm",
    "winrm_username": "Administrator",
    "winrm_password": "{{user `password`}}",
    "winrm_timeout": "3h",
    "shutdown_timeout": "1h",
    "shutdown_command": "shutdown /s /t 10 /f /d p:4:1 /c \"Packer Shutdown\"",
    "guest_os_type": "windows8srv-64",
    "disk_size": 131072,
    "disk_type_id":"0",
    "vnc_port_min": 5900,
    "vnc_port_max": 5980,
    "floppy_files": [
      "floppy/win2012r2-standard/Autounattend.xml",
      "scripts/init.bat",
      "scripts/winrm.bat"
    ],
    "vmdk_name": "{{user `name`}}",
    "vmx_data": {
      "mks.enable3d": "true",
      "memsize": "2048",
      "numvcpus": "2",
      "scsi0.virtualDev": "lsisas1068"
    },
    "vmx_data_post": {
      "ethernet0.connectionType": "bridged",
      "mks.enable3d": "true",
      "memsize": "2048",
      "numvcpus": "2",
      "scsi0.virtualDev": "lsisas1068"
  }
  }],

  "provisioners": [{
    "type": "powershell",
    "scripts": [
      "scripts/chocolatey.ps1"
    ]
  },{
    "type": "powershell",
    "inline": [
      "cinst -y 7zip",
      "cinst -y classic-shell -installArgs ADDLOCAL=ClassicStartMenu"
    ]
  },
  {
    "type": "powershell",
    "inline": ["Rename-Computer -NewName {{user `name`}}"]
  },
   {
    "type": "windows-shell",
    "scripts": [
      "scripts/vm-guest-tools.bat",
      "scripts/rdp.bat",
      "scripts/classicShellStyle.bat",
      "scripts/taskbarOptions.bat"
    ]
  }]
}
